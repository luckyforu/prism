<html>
	<head>
		<title>Ionic2 Push Notification</title>
		<meta charset="utf-8" />
		<html itemscope itemtype="http://nishanthkabra.com/ionic2push.html"/>

		<!-- Schema.org markup for Google+ -->
		<meta itemprop="name" content="Push notifications in Ionic2 apps powered by angular2">
		<meta itemprop="description" content="Add push notification features in your ionic2 hybrid mobile apps which is married to angular2(the next gen web framework). Push notifications from google cloud messaging platform using node-gcm plugin and test it on real android device.">
		<meta itemprop="image" content="http://nishanthkabra.com/images/push.png">

		<!-- Twitter Card data -->
		<meta name="twitter:card" content="Push notifications in Ionic2 apps powered by angular2">
		<meta name="twitter:site" content="@NishanthKabra">
		<meta name="twitter:title" content="Push notifications in Ionic2 apps powered by angular2">
		<meta name="twitter:description" content="Add push notification features in your ionic2 hybrid mobile apps which is married to angular2(the next gen web framework). Push notifications from google cloud messaging platform using node-gcm plugin and test it on real android device.">
		<meta name="twitter:creator" content="@NishanthKabra">
		<!-- Twitter summary card with large image must be at least 280x150px -->
		<meta name="twitter:image:src" content="http://nishanthkabra.com/images/push.png?1234">

		<!-- Open Graph data -->
		<meta property="og:url" content="http://nishanthkabra.com/ionic2push.html" />
		<meta property="og:title" content="Push notifications in Ionic2 apps powered by angular2" />
		<meta property="og:type" content="blog" />
		<meta property="og:image" content="http://nishanthkabra.com/images/push.png" />
		<meta property="og:description" content="Add push notification features in your ionic2 hybrid mobile apps which is married to angular2(the next gen web framework). Push notifications from google cloud messaging platform using node-gcm plugin and test it on real android device.">
		<meta property="fb:app_id" content="272166696459252" />

		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" >
		<link rel="canonical" href="http://nishanthkabra.com/ionic2push.html">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="keywords" content="ionic2, push notifications, hybrid mobile app, angular2, google cloud messaging, node-gcm" >
		<meta name="description" content="Add push notifications features in ionic2 hybrid mobile apps which is married to angular's latest version, 2. Push notifications from google cloud messaging using node-gcm plugin and test it on real android device.">
		<!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="assets/css/main.css" />
		<!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
	</head>
	<body>
		<div id="page-wrapper">

			<!-- Header -->
				<header id="header">
					<nav id="nav">
						<ul>
							<li><a href="index.html">Home</a></li>
							<li><a href="nishanthkabra.html">Nishanth Kabra</a></li>
						</ul>
					</nav>
				</header>


			<!-- Main -->
				<section id="main" class="container">
					<header>
						<h2>Ionic2 Push Notification</h2>
						<p>Everything is going mobile and engaging your mobile app users timely is a key to success of your business. With push notifications, you as a business can decide when, why, what and how to tell the users of your app about a business event which matters to them.(say an e-commerce app have new inventory). It brings the customer into the app's ecosystem even when they are offline(not actively using the app).</p>
					</header>
 						<img class="imagepush" src="http://nishanthkabra.com/images/push.png" alt="push notification on mobile device" title="push notification on mobile device" align="middle"/>
					<div class="box">
						<p>Implementing push notifications with ionic2(a hybrid mobile app framework) which is maried to angular2(the nest gen web framwework) has neven been this easier. Follow along with me for the rest of the post.</p>
						<div class="row">
							<div class="12u 12u(mobilep)">
										<ul>
											<h3>Quick demo on android device</h3>
											<a href="https://www.youtube.com/watch?v=RXIVwX7RTt4">Demo</a>
										</ul>
							</div>
							<div class="12u 12u(mobilep)">
											<ul>
											<h3>Setting up google cloud messaging platform</h3>
										<li>Create a google console project and enable google cloud messaging api in it,
										take a note of your google gcm key and your google project number, <a href="https://developers.google.com/web/fundamentals/getting-started/push-notifications/step-04?hl=en">Click here for set up</a></li>
										<li>Create a simple node server</li>
										<li>Install express
											<code>
												$ npm install express
											</code>
										</li>
										<li>Install node js google cloud messaging module
											<code>
												$ npm install node-gcm
											</code>
										</li>
										<li>Your server.js should be finally</li>
										<pre>
var express = require('express');
var gcm = require('node-gcm');
var app = express();
var gcmApiKey = 'XXXXXXXXXXXXX'; // GCM API KEY OF YOUR GOOGLE CONSOLE PROJECT

var server = app.listen(3000, function () {
    console.log('server is just fine!');
});

app.get('/', function (req, res) {
    res.send("This is basic route");
});

app.get('/push', function (req, res) {
    var device_tokens = []; //create array for storing device tokens
    
    var retry_times = 4; //the number of times to retry sending the message if it fails
    var sender = new gcm.Sender(gcmApiKey); //create a new sender
    var message = new gcm.Message(); //create a new message
    message.addData('title', 'PushTitle');
    message.addData('message', "Push message");
    message.addData('sound', 'default');
    message.collapseKey = 'Testing Push'; //grouping messages
    message.delayWhileIdle = true; //delay sending while receiving device is offline
    message.timeToLive = 3; //number of seconds to keep the message on 
    //server if the device is offline
    
    //Take the registration id(lengthy string) that you logged 
    //in your ionic v2 app and update device_tokens[0] with it for testing.
    //Later save device tokens to db and 
    //get back all tokens and push to multiple devices
    device_tokens[0] = "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX";
    sender.send(message, device_tokens[0], retry_times, function (result) {
        console.log('push sent to: ' + device_tokens);
        res.status(200).send('Pushed notification ' + device_tokens);
    }, function (err) {
        res.status(500).send('failed to push notification ');
    });
});
										</pre>
									</ul>
							</div>							
							<div class="12u 12u(mobilep)">
								<h3>Prerequites for ionic2 apps</h3>
						<ul>
							<li>Andorid sdk version 23 or above(or else your ionic v2 app wont build)</li>
							<li>Latest android build and platform tools</li>
							<li>Latest ionic version(ionic2 beta25 or above), ionic cli.</li>
							<li>Latest cordova, cordova cli</li>
						</ul>
								<h3>Setting up ionic2 app</h3>
									<ul>
										<li>Create a sample ionic version 2 typescript project
											<code>$ ionic start pushapp tutorial --v2 --ts</code>
										</li>
										<li>Add cordova push plugin
											<code>
												$ cordova plugin add phonegap-plugin-push --variable SENDER_ID="XXXXXXXXX"
											</code> here XXXXX is your google project number
										</li>
										<li>Update the app's package.json with following code</li>
<pre>
"cordovaPlugins": [
    {
      "variables": {
        "SENDER_ID": "XXXXXXXXXX"
      },
      "locator": "phonegap-plugin-push"
    }
  ]
</pre>
										<li>Open app.ts and import push
											<code>
												import {Push} from 'ionic-native';
											</code>
										</li>
										<li>Update the app.ts's initializeApp method with
										</li>
										<pre>
initializeApp() {
    this.platform.ready().then(() => {
      StatusBar.styleDefault();
      var push = Push.init({
        android: {
          senderID: "XXXXXXXXX"
        },
        ios: {
          alert: "true",
          badge: true,
          sound: 'false'
        },
        windows: {}
      });
      push.on('registration', (data) => {
        console.log(data.registrationId);
        alert(data.registrationId.toString());
      });
      push.on('notification', (data) => {
        console.log(data);
        alert("Hi, Am a push notification");
      });
      push.on('error', (e) => {
        console.log(e.message);
      });
    });
  }
										</pre>
										<li>Create android platform
											<code>
												$ ionic platform add android
											</code>
										</li>
										<li>Build android
											<code>
												$ ionic build android
											</code>
										</li>
										<li>Deploy to android device
											<code>
												$ ionic run android
											</code>
										</li>
									</div>
										
							<div class="12u 12u(mobilep)">
								<h3>Testing push notifications</h3>
									<ul>
										<li>Open browser or any rest client say post man</li>
										<li>hit <code>http://localhost:3000/push</code></li>
										<li>Boom! You get a notification in your device</li>
									</ul>
							<div>
							<div class="12u 12u(mobilep)">
								<h3>Clone the ionic2 setup from my git repo</h3>
									<ul>
										<li><a href="https://github.com/NishanthKabra/Ionic2-PushNotifications">My git repo</a></li>
									</ul>
							</div>
							<div class="12u 12u(mobilep)">
								<h3>Feedback</h3>
									<p>If this post helps you in setting up push notifications, do share.</p> 
							</div>
				</section>

			<!-- Footer -->
				<footer id="footer">
					<ul class="icons">
						<li><a href="https://twitter.com/NishanthKabra" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
						<li><a href="https://www.linkedin.com/in/nishanth-kabra-6b3a0359" class="icon fa-linkedin"><span class="label">LinkedIn</span></a></li>
						<li><a href="https://www.facebook.com/nishanth.kabra" class="icon fa-facebook"><span class="label">Facebook</span></a></li>
						<li><a href="https://www.instagram.com/nishanthkabra" class="icon fa-instagram"><span class="label">Instagram</span></a></li>
						<li><a href="https://github.com/NishanthKabra" class="icon fa-github"><span class="label">Github</span></a></li>
						<li><a href="https://plus.google.com/u/0/118354708916330484403/about" class="icon fa-google-plus"><span class="label">Google+</span></a></li>
					</ul>
					<ul class="copyright">
						<li>&copy;2016 | NishanthKabra.com. ALL RIGHTS RESERVED</li>
					</ul>
				</footer>

		</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.dropotron.min.js"></script>
			<script src="assets/js/jquery.scrollgress.min.js"></script>
			<script src="assets/js/skel.min.js"></script>
			<script src="assets/js/util.js"></script>
			<!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
			<script src="assets/js/main.js"></script>
			<script>
			  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
			
			  ga('create', 'UA-71237100-1', 'auto');
			  ga('send', 'pageview');
			
			</script>

	</body>
</html>